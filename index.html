<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Test de Dígitos</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 40px; }
    #sequence { font-size: 2em; margin: 20px; font-weight: bold; }
    input, button { padding: 10px; font-size: 1em; margin: 10px; }
    .hidden { display: none; }
    #historial { text-align: left; max-width: 600px; margin: 30px auto; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background-color: #f2f2f2; }
  </style>
</head>
<body>
  <h1>Test de Dígitos (Digit Span)</h1>
  <button onclick="startTest('directo')">Comenzar Dígitos Directo</button>
  <button onclick="startTest('inverso')">Comenzar Dígitos Inverso</button>

  <div id="sequence" class="hidden"></div>

  <div id="inputArea" class="hidden">
    <p id="instrucciones"></p>
    <input type="text" id="respuesta" placeholder="Escribe la secuencia">
    <button onclick="checkAnswer()">Enviar</button>
  </div>

  <p id="resultado"></p>
  <p id="scoreDisplay"></p>

  <div id="historial" class="hidden">
    <h2>Historial</h2>
    <table>
      <thead>
        <tr>
          <th>Nivel</th>
          <th>Secuencia Generada</th>
          <th>Tu Respuesta</th>
          <th>Correcto</th>
        </tr>
      </thead>
      <tbody id="tablaHistorial"></tbody>
    </table>
  </div>
<button id="btnFinalizar" class="hidden" onclick="finalizarTest()">Finalizar Test</button>


  <script>
    let currentSequence = [];
    let modo = "directo";
    let nivel = 4;
    let score = 0;
    let historial = [];

    function generarSecuencia(longitud) {
      let seq = [];
      for (let i = 0; i < longitud; i++) {
        seq.push(Math.floor(Math.random() * 9) + 1);
      }
      return seq;
    }

    function startTest(tipo) {
      modo = tipo; // <-- Esto debe estar al principio
      nivel = 4;
      score = 0;
      historial = [];
      document.getElementById("historial").classList.add("hidden");
      document.getElementById("tablaHistorial").innerHTML = "";
      document.getElementById("scoreDisplay").textContent = "";
      document.getElementById("resultado").textContent = "";
      document.getElementById("btnFinalizar").classList.remove("hidden");
      nextLevel();
    }

    function nextLevel() {
      currentSequence = generarSecuencia(nivel);
      document.getElementById("sequence").textContent = currentSequence.join(" ");
      document.getElementById("sequence").classList.remove("hidden");
      document.getElementById("inputArea").classList.add("hidden");
      document.getElementById("respuesta").value = "";

      let tiempoMostrar = nivel * 1000;

      setTimeout(() => {
        document.getElementById("sequence").classList.add("hidden");
        document.getElementById("inputArea").classList.remove("hidden");
        document.getElementById("instrucciones").textContent = (modo === "directo") ?
          "Escribe los números en el mismo orden:" :
          "Escribe los números en orden inverso:";
      }, tiempoMostrar);
    }

      function checkAnswer() {
      let input = document.getElementById("respuesta").value.trim();
      input = input.replace(/\s+/g, '');
      let respuestaUsuario = input.split('').map(Number);
    
      // CORRECTA según el modo
      let secuenciaCorrecta = (modo === "directo")
        ? currentSequence
        : [...currentSequence].reverse();
    
      let esCorrecto = (
        respuestaUsuario.length === secuenciaCorrecta.length &&
        respuestaUsuario.every((num, i) => num === secuenciaCorrecta[i])
      );
    
      if (esCorrecto) score++;
    
      historial.push({
        nivel: nivel,
        generado: currentSequence.slice(),
        respuesta: respuestaUsuario.slice(),
        correcto: esCorrecto
      });
    
      document.getElementById("resultado").textContent = esCorrecto
        ? `✅ Correcto (Puntaje: ${score})`
        : `❌ Incorrecto. Era: ${secuenciaCorrecta.join(" ")} (Puntaje: ${score})`;
    
      actualizarHistorial();
      nivel++;
    
      setTimeout(() => {
        document.getElementById("resultado").textContent = "";
        nextLevel();
      }, 2000);
    }

    function actualizarHistorial() {
      document.getElementById("scoreDisplay").textContent = `Puntaje actual: ${score}`;
      document.getElementById("historial").classList.remove("hidden");

      let tabla = document.getElementById("tablaHistorial");
      let ultima = historial[historial.length - 1];

      let fila = document.createElement("tr");
      fila.innerHTML = `
        <td>${ultima.nivel}</td>
        <td>${ultima.generado.join(" ")}</td>
        <td>${ultima.respuesta.join(" ")}</td>
        <td>${ultima.correcto ? "✅" : "❌"}</td>
      `;
      tabla.appendChild(fila);
    }
    function finalizarTest() {
  document.getElementById("sequence").classList.add("hidden");
  document.getElementById("inputArea").classList.add("hidden");
  document.getElementById("resultado").textContent = `✅ Test finalizado. Puntaje final: ${score}`;
  document.getElementById("scoreDisplay").textContent = `Puntaje final: ${score}`;
  document.getElementById("historial").classList.remove("hidden");
  document.getElementById("btnFinalizar").classList.add("hidden");

  // Evitar que continúe a otro nivel
  nivel = Infinity;
}
function nextLevel() {
  if (nivel === Infinity) return; // evita continuar si el test fue finalizado

  currentSequence = generarSecuencia(nivel);
  ...

  </script>
</body>
</html>
